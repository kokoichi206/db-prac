## docker

- docker の volume 永続化には、相対パスは使えない（$PWD を使って何とかする）
    - docker compose なら、相対パスでの記述可能！

## DB 設計

- 正規化
  - 大福帳
    - 全てのデータを1つにまとめたもの、から始めるとか
    - 組み合わせの爆発を防ぐため
  - ユニオンして正規化？は大変そう
  - 第3まではやった方がいい
- 外部キー制約
  - 貼らなくても最近問題にならないケースが多いかも？
    - ORM の辺の話
  - **MySQL 8.1,2 とかから(?), ALTER でロック取る範囲が広がった**
    - 親テーブルに対する ALTER を投げると、子テーブル側もロックされる
- スキーマ変更
  - カラムを追加した時に別テーブル？
  - 1つのカラムのために1テーブル作ることもある？
    - ライフサイクルなどが異なれば、全然ありかも
    - テーブルを分けてジョインしろ派
  - デフォルト Null だったら高速でカラムを追加できる？
    - デフォルトがあれば、参照時に返す方式にしてくれるので早い
  - Nullable なカラムは本当に必要なの？
    - 他の属性が漏れてないか
    - 既存の属性とライフサイクルが異なるんじゃないか？
    - **Update,Delete が増える場合は別のテーブルにする**
      - ddl かどうかとかその辺も関係する
- 大規模データ
  - postgresql
    - シャーディングする時, postgresql fdw みたいな飛び道具がある
    - alter 時に wal を逐次かくか？
    - **スキーマってのがある！**
  - mysql
    - postgresql に比べてディスクサイズ小さくなりがち
  - テラ級のテーブルは最近全然見る
    - 46TB とか
  - 10000 テーブルとかのシステムもある。。
    - パースして ER 図を書かせるとかは厳しいので、少なく抑えておいてほしい
    - FK で4段も5段もカスケードするのはやめて欲しいです
- 手がつけられない
  - mysql をキューみたいに使ってる
    - 10回くらいアップデートして、その後に削除
    - ジョブキューとして使うとか、たまにある？
    - スキップドロック
  - 50T とかあるとメンテナンスのたびに苦労する
  - マルチテナント, 3000-4000/テナント テーブルとかあると、しんどい
- テーブル名を年月日にする
  - 意外と1周回っていいのかもな
    - テーブル名を動的に作らないといけないところ以外
- ddl
  - mysql, transaction にできない
  - postgresql, transaction にできる
- OSS
  - パッケージ, CMS, blog とかも参考になる
    - **Redmine のテーブルとか**
      - プラグイン追加の仕組み？
- サロゲートキー・ナチュラルキー
  - サロゲートキーつけといたらいい？
  - 意味的なナチュラルキーはユニークで作るべき

### Links

- MySQLとインデックスと私
  - https://speakerdeck.com/yoku0825/mysqltoindetukusutosi
- PostgreSQLの仕組みから学ぶために必要な資料
  - https://soudai.hatenablog.com/entry/2024/01/18/150718
- Data Models
  - https://datamodels.databases.biz/
- 開発者のためのSQLパフォーマンスの全て
  - https://use-the-index-luke.com/ja/sql/table-of-contents
- アジャイル開発とデータベース設計 - 変化に対応するシンプルな実装のために必要なこと
  - https://agilejourney.uzabase.com/entry/2022/07/28/103000
